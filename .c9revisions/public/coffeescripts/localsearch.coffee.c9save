{"ts":1349104422118,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"class LocalSearch\n    constructor: (button) ->\n        @latitude = undefined;\n        @longitude = undefined;\n        @button = $(button)\n        ##@field = $(container).find(\".jqField\")\n        $(\"body\").on(\"click\", button, @search)\n        if navigator.geolocation\n            navigator.geolocation.getCurrentPosition (position) =>\n                @latitude = position.coords.latitude\n                @longitude = position.coords.longitude\n                return\n    search: (evt) =>\n        parent = $(evt.currentTarget).parent()\n        item = parent.find(\"h3\")\n        keywords = item.text()\n        keywords = keywords.replace /\\s/g, \"+\"\n        data =\n            latitude: @latitude\n            longitude: @longitude\n            keywords: keywords\n        Utility.ajaxOptions.url = \"/searchretailigence\"\n        Utility.ajaxOptions.success = (response) ->\n            if response.RetailigenceSearchResult\n                results = response.RetailigenceSearchResult\n                resultCount = results.count\n                parent.find(\".results\").empty()\n                parent.find(\".results\").append(\"<h3>Local Results</h3>\")\n                if resultCount                    \n                    items = results.results\n                    itemTemp = \"<li>\";\n                    itemTemp += \"<div class='name'><span class='bold'>Product:</span> {name}</div>\"\n                    itemTemp += \"<div class='desc'><span class='bold'>Product Description:</span> {desc}</div>\"\n                    itemTemp += \"<a href='{url}' class='url'>Link to Item</a>\"\n                    itemTemp += \"<div class='price'><span class='bold'>Price:</span> {price}<span class='currency'> in {currency}</span></div>\"\n                    itemTemp += \"<div class='sku'><span class='bold'>SKU:</span> {sku}</div>\"\n                    itemTemp += \"<div class='quantity'><span class='bold'>Quantity:</span> {quantity}</div>\"\n                    itemTemp += \"<div class='loc_name'><span class='bold'>Retailer:</span> {loc_name}</div>\"\n                    itemTemp += \"<input type='button' class='btn btn-small btnLocalMap' value='Map' />\"\n                    itemTemp += \"<input type='hidden' class='location' value='{location}' />\"\n                    itemTemp += \"</li>\"\n                    for item, i in items\n                        newTemp = itemTemp\n                        result = item.SearchResult\n                        name = result.product.name\n                        desc = result.product.descriptionLong\n                        price = result.price\n                        currency = result.currency\n                        sku = result.product.sku\n                        quantity = result.quantityText\n                        url = result.product.url\n                        location = result.location.location.latitude.toString() + \", \" + result.location.location.longitude.toString()\n                        loc_name = result.location.name\n                        newTemp = newTemp.replace(\"{name}\", name).replace(\"{desc}\", desc).replace(\"{url}\", url)\n                        newTemp = newTemp.replace(\"{price}\", price).replace(\"{currency}\", currency)\n                        newTemp = newTemp.replace(\"{sku}\", sku).replace(\"{quantity}\", quantity)\n                        newTemp = newTemp.replace(\"{loc_name}\", loc_name).replace(\"{location}\", location)\n                        parent.find(\".results\").append(newTemp)\n                else\n                    parent.find(\".results\").append(\"<div class='no_results'>Nothing Found Locally</div>\")\n            return\n        Utility.ajaxOptions.error = () ->\n            return\n        Utility.ajaxOptions.data = JSON.stringify(data)\n        $.ajax(Utility.ajaxOptions)"]],"start1":0,"start2":0,"length1":0,"length2":3721}]],"length":3721}
{"contributors":[],"silentsave":false,"ts":1349104440670,"patch":[[{"diffs":[[0,"        "],[-1,"parent"],[1,"btn"],[0," = $(evt"]],"start1":486,"start2":486,"length1":22,"length2":19},{"diffs":[[0,"tTarget)"],[1,"\n        parent = btn"],[0,".parent("]],"start1":512,"start2":512,"length1":16,"length2":37}]],"length":3739,"saved":false}
{"ts":1349104457641,"patch":[[{"diffs":[[0,"esponse) ->\n"],[1,"            btn.removeClass(\"disabled\")\n"],[0,"            "]],"start1":870,"start2":870,"length1":24,"length2":64}]],"length":3779,"saved":false}
{"ts":1349104471946,"patch":[[{"diffs":[[0,"ror = () ->\n"],[1,"            btn.removeClass(\"disabled\")\n"],[0,"            "]],"start1":3657,"start2":3657,"length1":24,"length2":64}]],"length":3819,"saved":false}
